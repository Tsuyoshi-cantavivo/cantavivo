{% extends 'base.html' %}

{% block title %}ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ | Tsuyoshi Iida{% endblock %}

{% block content %}
{% if not session.logged_in %}
  <section class="px-6 py-20 fade-in-on-scroll">
    <div class="max-w-xl mx-auto text-center">
      <h1 class="text-2xl font-semibold mb-4">ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™</h1>
      <p class="text-gray-600">ã“ã®ãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã«ã¯ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚</p>
      <a href="/login" class="inline-block mt-6 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã¸</a>
    </div>
  </section>
{% else %}
<section class="px-6 py-20 fade-in-on-scroll">
  <div class="max-w-6xl mx-auto">
    <div class="flex justify-between items-center mb-10">
      <h1 class="text-2xl font-semibold">ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
      <a href="/logout" class="text-red-500 hover:underline">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a>
    </div>

    <div class="grid gap-6 md:grid-cols-3">
      <a href="/admin/lesson-applications" class="block p-6 bg-white rounded-lg shadow hover:bg-blue-50 transition">
        <h2 class="text-xl font-semibold mb-2">ğŸ“‹ ãƒ¬ãƒƒã‚¹ãƒ³ç”³ã—è¾¼ã¿æƒ…å ±ç®¡ç†</h2>
        <p class="text-gray-600">ç”³ã—è¾¼ã¿å†…å®¹ã®ç¢ºèªã¨å‰Šé™¤</p>
      </a>

      <a href="/admin/concerts" class="block p-6 bg-white rounded-lg shadow hover:bg-blue-50 transition">
        <h2 class="text-xl font-semibold mb-2">ğŸ¤ å‡ºæ¼”æƒ…å ±ç®¡ç†</h2>
        <p class="text-gray-600">ã‚³ãƒ³ã‚µãƒ¼ãƒˆã®è¿½åŠ ãƒ»å‰Šé™¤</p>
      </a>

      <a href="/admin/contact-applications" class="block p-6 bg-white rounded-lg shadow hover:bg-blue-50 transition">
        <h2 class="text-xl font-semibold mb-2">ğŸ“¨ ãŠå•ã„åˆã‚ã›ç®¡ç†</h2>
        <p class="text-gray-600">é€ä¿¡ã•ã‚ŒãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ä¸€è¦§ç¢ºèª</p>
      </a>
    </div>

    <div class="mt-12">
      <h2 class="text-xl font-semibold mb-4">ğŸ“Š ãƒ¬ãƒƒã‚¹ãƒ³ç”³ã—è¾¼ã¿çŠ¶æ³ï¼ˆåˆ†æï¼‰</h2>
      <div class="grid md:grid-cols-2 gap-8">
        <div class="bg-white p-4 rounded shadow">
          <canvas id="monthlyChart" height="160"></canvas>
        </div>
        <div class="bg-white p-4 rounded shadow">
          <canvas id="ageChart" height="160"></canvas>
        </div>
        <div class="bg-white p-4 rounded shadow">
          <canvas id="categoryChart" height="160"></canvas>
        </div>
        <div class="bg-white p-4 rounded shadow">
          <canvas id="courseChart" height="160"></canvas>
        </div>
      </div>
    </div>
  </div>
</section>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  async function fetchAnalytics() {
    const res = await fetch('/admin/lesson-analytics-data');
    const data = await res.json();

    const chartConfigs = [
      { id: 'monthlyChart', label: 'æœˆåˆ¥ãƒ¬ãƒƒã‚¹ãƒ³ç”³è¾¼æ•°', labels: data.months.labels, values: data.months.counts },
      { id: 'ageChart', label: 'å¹´é½¢å±¤åˆ†å¸ƒ', labels: data.ages.labels, values: data.ages.counts },
      { id: 'categoryChart', label: 'ã‚«ãƒ†ã‚´ãƒªåˆ¥ç”³è¾¼æ•°', labels: data.categories.labels, values: data.categories.counts },
      { id: 'courseChart', label: 'ã‚³ãƒ¼ã‚¹åˆ¥ç”³è¾¼æ•°', labels: data.courses.labels, values: data.courses.counts }
    ];

    chartConfigs.forEach(cfg => {
      new Chart(document.getElementById(cfg.id), {
        type: 'bar',
        data: {
          labels: cfg.labels,
          datasets: [{
            label: cfg.label,
            data: cfg.values,
            backgroundColor: 'rgba(59, 130, 246, 0.6)',
            borderColor: '#3b82f6',
            borderWidth: 1
          }]
        },
        options: {
          plugins: { legend: { display: false } },
          responsive: true,
          maintainAspectRatio: false,
          scales: { y: { beginAtZero: true } }
        }
      });
    });
  }
  fetchAnalytics();
</script>
{% endif %}
{% endblock %}
